import{p as F,a as V,_ as G,b as R,c as W}from"./content-f21e8034.js";import{d as Y,c as C,r as J,e as a,f as b,k as n,al as K,w as s,j as u,F as Q,u as U,y as d,bf as l,A as p,x as _,q as c,Y as r,h as $}from"./@vue-a481fc63.js";import{u as X}from"./vuex-44de225f.js";import{u as Z}from"./vue-router-e5a2430e.js";import{S as ee,z as te,A as oe}from"./index-537a241d.js";import{c as se}from"./copy-to-clipboard-4ef7d3eb.js";import{k as ne,l as ae,n as le,o as ie,r as ue,G as ce,x as re,q as pe}from"./@vicons-4ed09704.js";import{j as v,o as _e,M as me,e as de,P as ve,a as he,O as fe}from"./naive-ui-defd0b2d.js";const ge={class:"post-item"},ke={class:"nickname-wrap"},ye={class:"username-wrap"},we={class:"timestamp-mobile"},be={class:"item-header-extra"},xe=["innerHTML"],Ce=["onClick"],$e=["onClick"],Ne=Y({__name:"mobile-post-item",props:{post:{},isOwner:{type:Boolean},addExtraAction:{type:Boolean}},emits:["send-whisper","handle-follow-action","handle-friend-action"],setup(z,{emit:g}){const i=z,k=Z(),q=X(),h=t=>()=>$(v,null,{default:()=>$(t)}),O=C(()=>{let t=[];return t.push({label:"私信",key:"whisper",icon:h(ue)}),!i.isOwner&&i.addExtraAction&&(i.post.user.is_following?t.push({label:"取消关注",key:"unfollow",icon:h(ce)}):t.push({label:"关注",key:"follow",icon:h(re)})),t.push({label:"复制链接",key:"copyTweetLink",icon:h(pe)}),t}),T=async t=>{switch(t){case"copyTweetLink":se(`${window.location.origin}/#/post?id=${e.value.id}&share=copy_link&t=${new Date().getTime()}`),window.$message.success("链接已复制到剪贴板");break;case"whisper":g("send-whisper",i.post.user);break;case"delete":case"requesting":g("handle-friend-action",i.post);break;case"follow":case"unfollow":g("handle-follow-action",i.post);break}},e=C({get:()=>{let t=Object.assign({texts:[],imgs:[],videos:[],links:[],attachments:[],charge_attachments:[]},i.post);return t.contents.map(o=>{(+o.type==1||+o.type==2)&&t.texts.push(o),+o.type==3&&t.imgs.push(o),+o.type==4&&t.videos.push(o),+o.type==6&&t.links.push(o),+o.type==7&&t.attachments.push(o),+o.type==8&&t.charge_attachments.push(o)}),t},set:t=>{i.post.upvote_count=t.upvote_count,i.post.collection_count=t.collection_count}}),P=()=>{te({id:e.value.id}).then(t=>{t.status?e.value={...e.value,upvote_count:e.value.upvote_count+1}:e.value={...e.value,upvote_count:e.value.upvote_count>0?e.value.upvote_count-1:0}}).catch(t=>{console.log(t)})},S=()=>{oe({id:e.value.id}).then(t=>{t.status?e.value={...e.value,collection_count:e.value.collection_count+1}:e.value={...e.value,collection_count:e.value.collection_count>0?e.value.collection_count-1:0}}).catch(t=>{console.log(t)})},y=t=>{k.push({name:"post",query:{id:t}})},B=(t,o)=>{if(t.target.dataset.detail){const m=t.target.dataset.detail.split(":");if(m.length===2){q.commit("refresh"),m[0]==="tag"?k.push({name:"home",query:{q:m[1],t:"tag"}}):k.push({name:"user",query:{s:m[1]}});return}}y(o)};return(t,o)=>{const m=_e,L=J("router-link"),w=me,A=de,M=ve,x=V,j=G,D=R,H=W,E=he,I=fe;return a(),b("div",ge,[n(I,{"content-indented":""},K({avatar:s(()=>[n(m,{round:"",size:30,src:e.value.user.avatar},null,8,["src"])]),header:s(()=>[u("span",ke,[n(L,{onClick:o[0]||(o[0]=d(()=>{},["stop"])),class:"username-link",to:{name:"user",query:{s:e.value.user.username}}},{default:s(()=>[p(_(e.value.user.nickname),1)]),_:1},8,["to"])]),u("span",ye," @"+_(e.value.user.username),1),e.value.is_top?(a(),c(w,{key:0,class:"top-tag",type:"warning",size:"small",round:""},{default:s(()=>[p(" 置顶 ")]),_:1})):r("",!0),e.value.visibility==1?(a(),c(w,{key:1,class:"top-tag",type:"error",size:"small",round:""},{default:s(()=>[p(" 私密 ")]),_:1})):r("",!0),e.value.visibility==2?(a(),c(w,{key:2,class:"top-tag",type:"info",size:"small",round:""},{default:s(()=>[p(" 好友可见 ")]),_:1})):r("",!0),u("div",null,[u("span",we,_(l(ee)(e.value.created_on))+" "+_(e.value.ip_loc),1)])]),"header-extra":s(()=>[u("div",be,[n(M,{placement:"bottom-end",trigger:"click",size:"small",options:O.value,onSelect:T},{default:s(()=>[n(A,{quaternary:"",circle:""},{icon:s(()=>[n(l(v),null,{default:s(()=>[n(l(ne))]),_:1})]),_:1})]),_:1},8,["options"])])]),footer:s(()=>[e.value.attachments.length>0?(a(),c(x,{key:0,attachments:e.value.attachments},null,8,["attachments"])):r("",!0),e.value.charge_attachments.length>0?(a(),c(x,{key:1,attachments:e.value.charge_attachments,price:e.value.attachment_price},null,8,["attachments","price"])):r("",!0),e.value.imgs.length>0?(a(),c(j,{key:2,imgs:e.value.imgs},null,8,["imgs"])):r("",!0),e.value.videos.length>0?(a(),c(D,{key:3,videos:e.value.videos},null,8,["videos"])):r("",!0),e.value.links.length>0?(a(),c(H,{key:4,links:e.value.links},null,8,["links"])):r("",!0)]),action:s(()=>[n(E,{justify:"space-between"},{default:s(()=>[u("div",{class:"opt-item",onClick:d(P,["stop"])},[n(l(v),{size:"18",class:"opt-item-icon"},{default:s(()=>[n(l(ae))]),_:1}),p(" "+_(e.value.upvote_count),1)],8,Ce),u("div",{class:"opt-item",onClick:o[3]||(o[3]=d(f=>y(e.value.id),["stop"]))},[n(l(v),{size:"18",class:"opt-item-icon"},{default:s(()=>[n(l(le))]),_:1}),p(" "+_(e.value.comment_count),1)]),u("div",{class:"opt-item",onClick:d(S,["stop"])},[n(l(v),{size:"18",class:"opt-item-icon"},{default:s(()=>[n(l(ie))]),_:1}),p(" "+_(e.value.collection_count),1)],8,$e)]),_:1})]),_:2},[e.value.texts.length>0?{name:"description",fn:s(()=>[u("div",{onClick:o[2]||(o[2]=f=>y(e.value.id))},[(a(!0),b(Q,null,U(e.value.texts,f=>(a(),b("span",{key:f.id,class:"post-text",onClick:o[1]||(o[1]=d(N=>B(N,e.value.id),["stop"])),innerHTML:l(F)(f.content).content},null,8,xe))),128))])]),key:"0"}:void 0]),1024)])}}});const ze={class:"nickname-wrap"},qe={class:"username-wrap"},Oe={class:"item-header-extra"},Te={class:"timestamp"},Pe=["innerHTML"],Se=["onClick"],Be=["onClick"],Fe=Y({__name:"post-item",props:{post:{},isOwner:{type:Boolean},addExtraAction:{type:Boolean}},emits:["send-whisper","handle-follow-action","handle-friend-action"],setup(z,{emit:g}){const i=z,k=Z(),q=X(),h=t=>()=>$(v,null,{default:()=>$(t)}),O=C(()=>{let t=[];return t.push({label:"私信",key:"whisper",icon:h(ue)}),!i.isOwner&&i.addExtraAction&&(i.post.user.is_following?t.push({label:"取消关注",key:"unfollow",icon:h(ce)}):t.push({label:"关注",key:"follow",icon:h(re)})),t.push({label:"复制链接",key:"copyTweetLink",icon:h(pe)}),t}),T=async t=>{switch(t){case"copyTweetLink":se(`${window.location.origin}/#/post?id=${e.value.id}&share=copy_link&t=${new Date().getTime()}`),window.$message.success("链接已复制到剪贴板");break;case"whisper":g("send-whisper",i.post.user);break;case"delete":case"requesting":g("handle-friend-action",i.post);break;case"follow":case"unfollow":g("handle-follow-action",i.post);break}},e=C({get:()=>{let t=Object.assign({texts:[],imgs:[],videos:[],links:[],attachments:[],charge_attachments:[]},i.post);return t.contents.map(o=>{(+o.type==1||+o.type==2)&&t.texts.push(o),+o.type==3&&t.imgs.push(o),+o.type==4&&t.videos.push(o),+o.type==6&&t.links.push(o),+o.type==7&&t.attachments.push(o),+o.type==8&&t.charge_attachments.push(o)}),t},set:t=>{i.post.upvote_count=t.upvote_count,i.post.collection_count=t.collection_count}}),P=()=>{te({id:e.value.id}).then(t=>{t.status?e.value={...e.value,upvote_count:e.value.upvote_count+1}:e.value={...e.value,upvote_count:e.value.upvote_count>0?e.value.upvote_count-1:0}}).catch(t=>{console.log(t)})},S=()=>{oe({id:e.value.id}).then(t=>{t.status?e.value={...e.value,collection_count:e.value.collection_count+1}:e.value={...e.value,collection_count:e.value.collection_count>0?e.value.collection_count-1:0}}).catch(t=>{console.log(t)})},y=t=>{k.push({name:"post",query:{id:t}})},B=(t,o)=>{if(t.target.dataset.detail){const m=t.target.dataset.detail.split(":");if(m.length===2){q.commit("refresh"),m[0]==="tag"?k.push({name:"home",query:{q:m[1],t:"tag"}}):k.push({name:"user",query:{s:m[1]}});return}}y(o)};return(t,o)=>{const m=_e,L=J("router-link"),w=me,A=de,M=ve,x=V,j=G,D=R,H=W,E=he,I=fe;return a(),b("div",{class:"post-item",onClick:o[3]||(o[3]=f=>y(e.value.id))},[n(I,{"content-indented":""},K({avatar:s(()=>[n(m,{round:"",size:30,src:e.value.user.avatar},null,8,["src"])]),header:s(()=>[u("span",ze,[n(L,{onClick:o[0]||(o[0]=d(()=>{},["stop"])),class:"username-link",to:{name:"user",query:{s:e.value.user.username}}},{default:s(()=>[p(_(e.value.user.nickname),1)]),_:1},8,["to"])]),u("span",qe," @"+_(e.value.user.username),1),e.value.is_top?(a(),c(w,{key:0,class:"top-tag",type:"warning",size:"small",round:""},{default:s(()=>[p(" 置顶 ")]),_:1})):r("",!0),e.value.visibility==1?(a(),c(w,{key:1,class:"top-tag",type:"error",size:"small",round:""},{default:s(()=>[p(" 私密 ")]),_:1})):r("",!0),e.value.visibility==2?(a(),c(w,{key:2,class:"top-tag",type:"info",size:"small",round:""},{default:s(()=>[p(" 好友可见 ")]),_:1})):r("",!0)]),"header-extra":s(()=>[u("div",Oe,[u("span",Te,_(e.value.ip_loc?e.value.ip_loc+" · ":e.value.ip_loc)+" "+_(l(ee)(e.value.created_on)),1),n(M,{placement:"bottom-end",trigger:"hover",size:"small",options:O.value,onSelect:T},{default:s(()=>[n(A,{quaternary:"",circle:""},{icon:s(()=>[n(l(v),null,{default:s(()=>[n(l(ne))]),_:1})]),_:1})]),_:1},8,["options"])])]),footer:s(()=>[e.value.attachments.length>0?(a(),c(x,{key:0,attachments:e.value.attachments},null,8,["attachments"])):r("",!0),e.value.charge_attachments.length>0?(a(),c(x,{key:1,attachments:e.value.charge_attachments,price:e.value.attachment_price},null,8,["attachments","price"])):r("",!0),e.value.imgs.length>0?(a(),c(j,{key:2,imgs:e.value.imgs},null,8,["imgs"])):r("",!0),e.value.videos.length>0?(a(),c(D,{key:3,videos:e.value.videos},null,8,["videos"])):r("",!0),e.value.links.length>0?(a(),c(H,{key:4,links:e.value.links},null,8,["links"])):r("",!0)]),action:s(()=>[n(E,{justify:"space-between"},{default:s(()=>[u("div",{class:"opt-item hover",onClick:d(P,["stop"])},[n(l(v),{size:"18",class:"opt-item-icon"},{default:s(()=>[n(l(ae))]),_:1}),p(" "+_(e.value.upvote_count),1)],8,Se),u("div",{class:"opt-item hover",onClick:o[2]||(o[2]=d(f=>y(e.value.id),["stop"]))},[n(l(v),{size:"18",class:"opt-item-icon"},{default:s(()=>[n(l(le))]),_:1}),p(" "+_(e.value.comment_count),1)]),u("div",{class:"opt-item hover",onClick:d(S,["stop"])},[n(l(v),{size:"18",class:"opt-item-icon"},{default:s(()=>[n(l(ie))]),_:1}),p(" "+_(e.value.collection_count),1)],8,Be)]),_:1})]),_:2},[e.value.texts.length>0?{name:"description",fn:s(()=>[(a(!0),b(Q,null,U(e.value.texts,f=>(a(),b("span",{key:f.id,class:"post-text hover",onClick:o[1]||(o[1]=d(N=>B(N,e.value.id),["stop"])),innerHTML:l(F)(f.content).content},null,8,Pe))),128))]),key:"0"}:void 0]),1024)])}}});export{Fe as _,Ne as a};
