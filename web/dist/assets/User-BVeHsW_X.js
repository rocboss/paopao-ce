import{_ as He,a as Ve}from"./post-item.vue_vue_type_style_index_0_lang-3gNUBBWd.js";import{_ as je}from"./post-skeleton-B6KFVL2X.js";import{_ as Ge}from"./whisper-CD0RDnNY.js";import{_ as Je}from"./main-nav.vue_vue_type_style_index_0_lang-D7-FAbTY.js";import{d as Qe,r,U as Ye,c as Ee,b as Ke,C as Xe,f as u,q as o,t as h,Y as m,w as v,h as me,k as w,z as A,bq as c,G as D,l as Ze,A as fe,F,x as T,j as t}from"./@vue-9sINKCPW.js";import{u as ea}from"./vuex--ttreJMD.js";import{b as aa,u as ta}from"./vue-router-yrkFRUM9.js";import{M as sa,e as R,L as la,h as na,u as pe,f as ge,N as oa,_ as ua}from"./index-DxHQoSDp.js";import{W as ia}from"./whisper-add-friend-EUQIGn8g.js";import{p as ce}from"./count-BK58UQ2M.js";import{Y as ra}from"./v3-infinite-loading-D3303HHP.js";import{a as ca,r as va,G as he,s as _a,t as da,J as ma,R as fa,q as pa}from"./@vicons-PCg97L0F.js";import{F as ga,G as ha,i as we,a as wa,j as ka,m as ya,O as ba,Q as Oa,B as Pa,g as Fa,f as Ta,J as Ia,H as Aa}from"./naive-ui-BJojRuLw.js";import"./content-x8CCof-x.js";import"./paopao-video-player-FrzfkELx.js";import"./copy-to-clipboard-DgsYVcxl.js";import"./toggle-selection-DGa8lynz.js";import"./vooks-CfQnrjIt.js";import"./evtd-CI_DDEu_.js";import"./axios-t--hEgTQ.js";import"./moment-P60zs0je.js";/* empty css               */import"./seemly-D-teBmey.js";import"./vueuc-DrMWnH2h.js";import"./@css-render-DN2R7sM6.js";import"./vdirs-DRH9Xvnd.js";import"./@juggle-C8OzoCMD.js";import"./css-render-BDrvWz3H.js";import"./@emotion-WldOFDRm.js";import"./lodash-es-TJvrUncL.js";import"./treemate-HRdUPn5m.js";import"./async-validator-9PlIezaS.js";import"./date-fns-Db9XENWt.js";const qa={key:0,class:"profile-baseinfo"},xa={class:"avatar"},za={class:"base-info"},Ua={class:"username"},$a={class:"userinfo"},Ca={class:"info-item"},Sa={class:"info-item"},Ma={class:"userinfo"},Wa={class:"info-item"},La={class:"info-item"},Ba={class:"info-item"},Na={key:0,class:"user-opts"},Da={key:0,class:"skeleton-wrap"},Ra={key:1},Ha={key:0,class:"empty-wrap"},Va={key:1},ja={key:0},Ga={key:1},Ja={key:2},Qa={key:3},Ya={key:4},Ea={key:2},Ka={key:0},Xa={key:1},Za={key:2},et={key:3},at={key:4},tt={class:"load-more-wrap"},st={class:"load-more-spinner"},lt=Qe({__name:"User",setup(nt){const H=ga(),_=ea(),x=aa(),ke=ta(),f=r(!1),y=r(!1),a=Ye({id:0,avatar:"",username:"",nickname:"",is_admin:!1,is_friend:!0,is_following:!1,created_on:0,follows:0,followings:0,tweets_count:0,status:1}),p=r(!1),V=r(!1),J=r(!1),l=r([]),z=r([]),U=r([]),$=r([]),C=r([]),S=r([]),q=r(x.query.s||""),n=r(+x.query.p||1),g=r("post"),Q=r(+x.query.p||1),Y=r(1),E=r(1),K=r(1),X=r(1),k=r(20),d=r(0),Z=r(0),ee=r(0),ae=r(0),te=r(0),se=r(0),b=e=>{a.id=e.id,a.username=e.username,a.nickname=e.nickname,a.avatar=e.avatar,V.value=!0},O=e=>{H.success({title:"提示",content:"确定"+(e.user.is_following?"取消关注 @":"关注 @")+e.user.username+" 吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{e.user.is_following?pe({user_id:e.user.id}).then(i=>{window.$message.success("操作成功"),ve(e.user_id,!1)}).catch(i=>{}):ge({user_id:e.user.id}).then(i=>{window.$message.success("关注成功"),ve(e.user_id,!0)}).catch(i=>{})}})};function ve(e,i){M(z,e,i),M(U,e,i),M($,e,i),M(C,e,i),M(S,e,i)}function M(e,i,ie){if(e.value&&e.value.length>0)for(let G in e.value)e.value[G].user_id==i&&(e.value[G].user.is_following=ie)}const ye=()=>{y.value=!1,l.value=[],z.value=[],U.value=[],$.value=[],C.value=[],S.value=[],g.value="post",n.value=1,Q.value=1,Y.value=1,E.value=1,K.value=1,X.value=1,d.value=0,Z.value=0,ee.value=0,ae.value=0,te.value=0,se.value=0},be=()=>{switch(g.value){case"post":j();break;case"comment":le();break;case"highlight":ne();break;case"media":oe();break;case"star":ue();break}},j=()=>{f.value=!0,R({username:q.value,style:"post",page:n.value,page_size:k.value}).then(e=>{f.value=!1,e.list.length===0&&(y.value=!0),n.value>1?l.value=l.value.concat(e.list):(l.value=e.list||[],window.scrollTo(0,0)),d.value=Math.ceil(e.pager.total_rows/k.value),z.value=l.value,Z.value=d.value}).catch(e=>{l.value=[],n.value>1&&n.value--,f.value=!1})},le=()=>{f.value=!0,R({username:q.value,style:"comment",page:n.value,page_size:k.value}).then(e=>{f.value=!1,e.list.length===0&&(y.value=!0),n.value>1?l.value=l.value.concat(e.list):(l.value=e.list||[],window.scrollTo(0,0)),d.value=Math.ceil(e.pager.total_rows/k.value),U.value=l.value,ee.value=d.value}).catch(e=>{l.value=[],n.value>1&&n.value--,f.value=!1})},ne=()=>{f.value=!0,R({username:q.value,style:"highlight",page:n.value,page_size:k.value}).then(e=>{f.value=!1,e.list.length===0&&(y.value=!0),n.value>1?l.value=l.value.concat(e.list):(l.value=e.list||[],window.scrollTo(0,0)),d.value=Math.ceil(e.pager.total_rows/k.value),$.value=l.value,ae.value=d.value}).catch(e=>{l.value=[],n.value>1&&n.value--,f.value=!1})},oe=()=>{f.value=!0,R({username:q.value,style:"media",page:n.value,page_size:k.value}).then(e=>{f.value=!1,e.list.length===0&&(y.value=!0),n.value>1?l.value=l.value.concat(e.list):(l.value=e.list||[],window.scrollTo(0,0)),d.value=Math.ceil(e.pager.total_rows/k.value),C.value=l.value,te.value=d.value}).catch(e=>{l.value=[],n.value>1&&n.value--,f.value=!1})},ue=()=>{f.value=!0,R({username:q.value,style:"star",page:n.value,page_size:k.value}).then(e=>{f.value=!1,e.list.length===0&&(y.value=!0),n.value>1?l.value=l.value.concat(e.list):(l.value=e.list||[],window.scrollTo(0,0)),d.value=Math.ceil(e.pager.total_rows/k.value),S.value=l.value,se.value=d.value}).catch(e=>{l.value=[],n.value>1&&n.value--,f.value=!1})},Oe=e=>{switch(g.value=e,g.value){case"post":l.value=z.value,n.value=Q.value,d.value=Z.value,j();break;case"comment":l.value=U.value,n.value=Y.value,d.value=ee.value,le();break;case"highlight":l.value=$.value,n.value=E.value,d.value=ae.value,ne();break;case"media":l.value=C.value,n.value=K.value,d.value=te.value,oe();break;case"star":l.value=S.value,n.value=X.value,d.value=se.value,ue();break}},W=()=>{p.value=!0,sa({username:q.value}).then(e=>{p.value=!1,a.id=e.id,a.avatar=e.avatar,a.username=e.username,a.nickname=e.nickname,a.is_admin=e.is_admin,a.is_friend=e.is_friend,a.created_on=e.created_on,a.is_following=e.is_following,a.follows=e.follows,a.followings=e.followings,a.status=e.status,e.tweets_count&&(a.tweets_count=e.tweets_count),be()}).catch(e=>{p.value=!1,console.log(e)})},Pe=()=>{switch(g.value){case"post":Q.value=n.value,j();break;case"comment":Y.value=n.value,le();break;case"highlight":E.value=n.value,ne();break;case"media":K.value=n.value,oe();break;case"star":X.value=n.value,ue();break}},Fe=()=>{V.value=!0},Te=()=>{J.value=!0},Ie=()=>{V.value=!1},Ae=()=>{J.value=!1},I=e=>()=>me(we,null,{default:()=>me(e)}),qe=Ee(()=>{if(_.state.userInfo.username==a.username)return[{label:"设置",key:"setting",icon:I(ca)}];let e=[{label:"私信",key:"whisper",icon:I(va)}];return _.state.userInfo.is_admin&&(a.status===1?e.push({label:"禁言",key:"banned",icon:I(he)}):e.push({label:"解封",key:"deblocking",icon:I(he)})),a.is_following?e.push({label:"取消关注",key:"unfollow",icon:I(_a)}):e.push({label:"关注",key:"follow",icon:I(da)}),_.state.profile.useFriendship&&(a.is_friend?e.push({label:"删除好友",key:"delete",icon:I(ma)}):e.push({label:"添加朋友",key:"requesting",icon:I(fa)})),e}),xe=e=>{switch(e){case"whisper":Fe();break;case"delete":ze();break;case"requesting":Te();break;case"follow":case"unfollow":Ue();break;case"banned":case"deblocking":$e();break;case"setting":ke.push({name:"setting",query:{t:new Date().getTime()}});break}},ze=()=>{H.warning({title:"删除好友",content:"将好友 “"+a.nickname+"” 删除，将同时删除 点赞/收藏 列表中关于该朋友的 “好友可见” 推文",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{p.value=!0,na({user_id:a.id}).then(e=>{p.value=!1,a.is_friend=!1,j()}).catch(e=>{p.value=!1,console.log(e)})}})},Ue=()=>{H.success({title:"提示",content:"确定"+(a.is_following?"取消关注 @":"关注 @")+a.username+" 吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{p.value=!0,a.is_following?pe({user_id:a.id}).then(e=>{p.value=!1,window.$message.success("操作成功"),W()}).catch(e=>{p.value=!1,console.log(e)}):ge({user_id:a.id}).then(e=>{p.value=!1,window.$message.success("操作成功"),W()}).catch(e=>{p.value=!1,console.log(e)})}})},$e=()=>{H.warning({title:"警告",content:"确定对该用户进行"+(a.status===1?"禁言":"解封")+"处理吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{p.value=!0,oa({id:a.id,status:a.status===1?2:1}).then(e=>{p.value=!1,a.status===1?window.$message.success("禁言成功"):window.$message.success("解封成功"),W()}).catch(e=>{p.value=!1,console.log(e)})}})},Ce=()=>{n.value<d.value||d.value==0?(y.value=!1,n.value++,Pe()):y.value=!0};return Ke(()=>{W()}),Xe(()=>({path:x.path,query:x.query}),(e,i)=>{i.path==="/u"&&e.path==="/u"&&(q.value=x.query.s||"",ye(),W())}),(e,i)=>{const ie=Je,G=ya,re=ba,_e=Ze("router-link"),Se=Pa,Me=Oa,We=Ge,L=Fa,Le=Ta,de=ka,Be=je,Ne=Ia,B=He,P=Aa,N=Ve,De=ha,Re=wa;return t(),u("div",null,[o(ie,{title:"用户详情"}),o(De,{class:"main-content-wrap profile-wrap",bordered:""},{default:v(()=>[o(de,{show:p.value},{default:v(()=>[a.id>0?(t(),u("div",qa,[w("div",xa,[o(G,{size:72,src:a.avatar},null,8,["src"])]),w("div",za,[w("div",Ua,[w("strong",null,A(a.nickname),1),w("span",null," @"+A(a.username),1),c(_).state.profile.useFriendship&&c(_).state.userInfo.id>0&&c(_).state.userInfo.username!=a.username&&a.is_friend?(t(),h(re,{key:0,class:"top-tag",type:"info",size:"small",round:""},{default:v(()=>i[3]||(i[3]=[D(" 好友 ")])),_:1})):m("",!0),c(_).state.userInfo.id>0&&c(_).state.userInfo.username!=a.username&&a.is_following?(t(),h(re,{key:1,class:"top-tag",type:"success",size:"small",round:""},{default:v(()=>i[4]||(i[4]=[D(" 已关注 ")])),_:1})):m("",!0),a.is_admin?(t(),h(re,{key:2,class:"top-tag",type:"error",size:"small",round:""},{default:v(()=>i[5]||(i[5]=[D(" 管理员 ")])),_:1})):m("",!0)]),w("div",$a,[w("span",Ca,"UID. "+A(a.id),1),w("span",Sa,A(c(la)(a.created_on))+" 加入",1)]),w("div",Ma,[w("span",Wa,[o(_e,{onClick:i[0]||(i[0]=fe(()=>{},["stop"])),class:"following-link",to:{name:"following",query:{s:a.username,n:a.nickname,t:"follows"}}},{default:v(()=>[D(" 关注  "+A(c(ce)(a.follows)),1)]),_:1},8,["to"])]),w("span",La,[o(_e,{onClick:i[1]||(i[1]=fe(()=>{},["stop"])),class:"following-link",to:{name:"following",query:{s:a.username,n:a.nickname,t:"followings"}}},{default:v(()=>[D(" 粉丝  "+A(c(ce)(a.followings)),1)]),_:1},8,["to"])]),w("span",Ba," 泡泡  "+A(c(ce)(a.tweets_count||0)),1)])]),c(_).state.userInfo.id>0?(t(),u("div",Na,[o(Me,{placement:"bottom-end",trigger:"click",size:"small",options:qe.value,onSelect:xe},{default:v(()=>[o(Se,{quaternary:"",circle:""},{icon:v(()=>[o(c(we),null,{default:v(()=>[o(c(pa))]),_:1})]),_:1})]),_:1},8,["options"])])):m("",!0)])):m("",!0),o(We,{show:V.value,user:a,onSuccess:Ie},null,8,["show","user"]),o(ia,{show:J.value,user:a,onSuccess:Ae},null,8,["show","user"]),p.value?m("",!0):(t(),h(Le,{key:1,class:"profile-tabs-wrap",type:"line",animated:"",value:g.value,"onUpdate:value":Oe},{default:v(()=>[o(L,{name:"post",tab:"泡泡"}),o(L,{name:"comment",tab:"评论"}),o(L,{name:"highlight",tab:"亮点"}),o(L,{name:"media",tab:"图文"}),o(L,{name:"star",tab:"喜欢"})]),_:1},8,["value"]))]),_:1},8,["show"]),f.value&&l.value.length===0?(t(),u("div",Da,[o(Be,{num:k.value},null,8,["num"])])):(t(),u("div",Ra,[l.value.length===0?(t(),u("div",Ha,[o(Ne,{size:"large",description:"暂无数据"})])):m("",!0),c(_).state.desktopModelShow?(t(),u("div",Va,[g.value==="post"?(t(),u("div",ja,[(t(!0),u(F,null,T(z.value,s=>(t(),h(P,{key:s.id},{default:v(()=>[o(B,{post:s,isOwner:c(_).state.userInfo.id==s.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:O},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),g.value==="comment"?(t(),u("div",Ga,[(t(!0),u(F,null,T(U.value,s=>(t(),h(P,{key:s.id},{default:v(()=>[o(B,{post:s,isOwner:c(_).state.userInfo.id==s.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:O},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),g.value==="highlight"?(t(),u("div",Ja,[(t(!0),u(F,null,T($.value,s=>(t(),h(P,{key:s.id},{default:v(()=>[o(B,{post:s,isOwner:c(_).state.userInfo.id==s.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:O},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),g.value==="media"?(t(),u("div",Qa,[(t(!0),u(F,null,T(C.value,s=>(t(),h(P,{key:s.id},{default:v(()=>[o(B,{post:s,isOwner:c(_).state.userInfo.id==s.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:O},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),g.value==="star"?(t(),u("div",Ya,[(t(!0),u(F,null,T(S.value,s=>(t(),h(P,{key:s.id},{default:v(()=>[o(B,{post:s,isOwner:c(_).state.userInfo.id==s.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:O},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0)])):(t(),u("div",Ea,[g.value==="post"?(t(),u("div",Ka,[(t(!0),u(F,null,T(z.value,s=>(t(),h(P,{key:s.id},{default:v(()=>[o(N,{post:s,isOwner:c(_).state.userInfo.id==s.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:O},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),g.value==="comment"?(t(),u("div",Xa,[(t(!0),u(F,null,T(U.value,s=>(t(),h(P,{key:s.id},{default:v(()=>[o(N,{post:s,isOwner:c(_).state.userInfo.id==s.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:O},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),g.value==="highlight"?(t(),u("div",Za,[(t(!0),u(F,null,T($.value,s=>(t(),h(P,{key:s.id},{default:v(()=>[o(N,{post:s,isOwner:c(_).state.userInfo.id==s.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:O},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),g.value==="media"?(t(),u("div",et,[(t(!0),u(F,null,T(C.value,s=>(t(),h(P,{key:s.id},{default:v(()=>[o(N,{post:s,isOwner:c(_).state.userInfo.id==s.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:O},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0),g.value==="star"?(t(),u("div",at,[(t(!0),u(F,null,T(S.value,s=>(t(),h(P,{key:s.id},{default:v(()=>[o(N,{post:s,isOwner:c(_).state.userInfo.id==s.user_id,addFollowAction:!0,onSendWhisper:b,onHandleFollowAction:O},null,8,["post","isOwner"])]),_:2},1024))),128))])):m("",!0)]))]))]),_:1}),d.value>0?(t(),h(Re,{key:0,justify:"center"},{default:v(()=>[o(c(ra),{class:"load-more",slots:{complete:"没有更多泡泡了",error:"加载出错"},onInfinite:i[2]||(i[2]=s=>Ce())},{spinner:v(()=>[w("div",tt,[y.value?m("",!0):(t(),h(de,{key:0,size:14})),w("span",st,A(y.value?"没有更多泡泡了":"加载更多"),1)])]),_:1})]),_:1})):m("",!0)])}}}),Bt=ua(lt,[["__scopeId","data-v-00ab4b4e"]]);export{Bt as default};
